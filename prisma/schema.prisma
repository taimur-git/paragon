// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}
generator erd {
  provider = "prisma-erd-generator"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model AuthUser {
    id            String    @id @unique
    username      String    @unique
    auth_session  AuthSession[]
    auth_key      AuthKey[]
    user User?
    @@map("auth_user")
}

model AuthSession {
    id             String @id @unique
    user_id        String
    active_expires BigInt
    idle_expires   BigInt
    auth_user           AuthUser   @relation(references: [id], fields: [user_id], onDelete: Cascade)

    @@index([user_id])
    @@map("auth_session")
}

model AuthKey {
    id              String  @id @unique 
    hashed_password String?
    user_id         String
    primary_key     Boolean
    expires         BigInt?
    auth_user       AuthUser    @relation(references: [id], fields: [user_id], onDelete: Cascade)

    @@index([user_id])
    @@map("auth_key")
}

model User {
//the ID comes from the auth_user table
  id    String    @id @unique(map:"authid")
  authid String    @unique
  
  authUser  AuthUser @relation(fields: [authid], references: [id])

  email String  @unique
  name  String //full name
  dateJoined DateTime @default(now())

  dateOfBirth DateTime?
  gender String? //male, female, other
  phone String? @unique //phone number, will be used for verification and will stay secret
  image String? //url to the image
  major String? //CSE, EEE, etc
  bio String?
  //institute String? //from BRAC, NSU, IUB, etc
  levelOfStudy String? //BSc, MSc, PhD, etc
  extraInfo String? //if they are willing to help through phone, first class free, etc
  institute University? //from BRAC, NSU, IUB, etc

  location Location? 

  credentials Credential[] 
  //location

  
  ads Ad[]
  tuitions Tuition[]
  ratings Rating[]
}


model Credential{
  id Int @id @default(autoincrement())
  claim String
  proof String? //url to the pdf/jpeg upload
  verified Boolean @default(false)
  user User @relation(fields: [userId], references: [id])
  userId String
  @@unique(fields:[claim,userId],name:"credential_id")
  dateVerified DateTime?
  dateCreated DateTime @default(now())
}

model Tuition{
  id Int @id @default(autoincrement())
  userid String
  user User @relation(fields: [userid], references: [id])
  

  dateCreated DateTime @default(now())
  dateUpdated DateTime @updatedAt
  dateDeleted DateTime?
  
  tuitionTags TuitionTag[]

  background TuitionBackground[] //bangla medium, english medium, etc
  subjects TuitionSubject[] //math, physics, etc
  classes TuitionClasses[] //class 1-12, university, etc
  educationBoard TuitionBoard[] //cambridge, edexcel, etc

  preferredGender String?
  preferredInstitute String?
  location String?
}

model Ad{
  id Int @id @default(autoincrement())
  userid String
  user User @relation(fields: [userid], references: [id])

  dateCreated DateTime @default(now())
  dateUpdated DateTime @updatedAt
  dateDeleted DateTime?
  visible Boolean @default(true)

  tags AdTag[]


  background AdBackground[] //bangla medium, english medium, etc
  subjects AdSubject[] //math, physics, etc
  classes AdClasses[] //class 1-12, university, etc
  educationBoard AdBoard[] //cambridge, edexcel, etc

  typeOfTutor String? //online, offline, both
  expectedSalary Int? //per week or per month or negotiable
  salaryType String? //per week or per month  or negotiable
  description String?
  
  ratings Rating[]
}

model Tag{
  id Int @id @default(autoincrement())
  name String @unique
  tagTypeId Int
  tagType TagType @relation(fields: [tagTypeId], references: [id])
  ads AdTag[]
  tuitions TuitionTag[]
}

model TagType{
  id Int @id @default(autoincrement())
  name String @unique //subject, class, board, background, etc
  tags Tag[]
}

model AdTag{
  id        Int @id @default(autoincrement())
  adId      Int
  tagId Int
  tag Tag @relation(fields: [tagId], references: [id])
  ad        Ad @relation(fields: [adId], references: [id])
}

model TuitionTag{
  id        Int @id @default(autoincrement())
  tuitionId      Int
  tagId Int
  tag Tag @relation(fields: [tagId], references: [id])
  tuition        Tuition @relation(fields: [tuitionId], references: [id])
}

model Background{
  id Int @id @default(autoincrement())
  name String @unique
  ads AdBackground[]
  tuitions TuitionBackground[]
}
model Subject{
  id Int @id @default(autoincrement())
  name String @unique
  ads AdSubject[]
  tuitions TuitionSubject[]
}

model Board{
  id Int @id @default(autoincrement())
  name String @unique
  ads AdBoard[]
  tuitions TuitionBoard[]
}
model Class{
  id Int @id @default(autoincrement())
  name String @unique
  ads AdClasses[]
  tuitions TuitionClasses[]
}

model University{
  id Int @id @default(autoincrement())
  name String @unique
  alias String? @unique
  //ads AdUniversity[]
  //tuitions TuitionUniversity[]
  users User[]
}

model Disabilities{
  id Int @id @default(autoincrement())
  name String @unique
  //ads AdDisabilities[]
  //tuitions TuitionDisabilities[]
}

model Skill{
  id Int @id @default(autoincrement())
  name String @unique
  //ads AdSkill[]
  //tuitions TuitionSkill[]
}

model Language{
  id Int @id @default(autoincrement())
  name String @unique
  //ads AdLanguage[]
  //tuitions TuitionLanguage[]
}

model AdBackground{
  id        Int @id @default(autoincrement())
  adId      Int
  backgroundId Int
  background Background @relation(fields: [backgroundId], references: [id])
  ad        Ad @relation(fields: [adId], references: [id])
}
model AdSubject {
  id        Int    @id @default(autoincrement())
  adId      Int
  subjectId Int
  subject   Subject @relation(fields: [subjectId], references: [id])
  ad        Ad     @relation(fields: [adId], references: [id])
}
model AdClasses {
  id        Int    @id @default(autoincrement())
  adId      Int
  classId   Int
  class     Class @relation(fields: [classId], references: [id])
  ad        Ad     @relation(fields: [adId], references: [id])
}
model AdBoard {
  id        Int    @id @default(autoincrement())
  adId      Int
  boardId   Int
  board     Board @relation(fields: [boardId], references: [id])
  ad        Ad     @relation(fields: [adId], references: [id])
}

model TuitionBackground{
  id        Int @id @default(autoincrement())
  tuitionId      Int
  backgroundId Int
  background Background @relation(fields: [backgroundId], references: [id])
  tuition        Tuition @relation(fields: [tuitionId], references: [id])
}
model TuitionSubject {
  id        Int    @id @default(autoincrement())
  tuitionId      Int
  subjectId Int
  subject   Subject @relation(fields: [subjectId], references: [id])
  tuition        Tuition     @relation(fields: [tuitionId], references: [id])
}
model TuitionClasses {
  id        Int    @id @default(autoincrement())
  tuitionId      Int
  classId   Int
  class     Class @relation(fields: [classId], references: [id])
  tuition        Tuition     @relation(fields: [tuitionId], references: [id])
}

model TuitionBoard {
  id        Int    @id @default(autoincrement())
  tuitionId      Int
  boardId   Int
  board     Board @relation(fields: [boardId], references: [id])
  tuition        Tuition     @relation(fields: [tuitionId], references: [id])
}

model Rating{
  ad_id Int
  reviewer_id String
  stars Int //0-5
  review String
  @@unique(fields:[ad_id,reviewer_id],name:"rating_id")
  ad Ad @relation(fields: [ad_id], references: [id])
  reviewer User @relation(fields: [reviewer_id], references: [id])
}



model Location{
  longitude Int
  latitude Int 
  radius Int
  geocodedLocation String
  @@unique(fields:[longitude,latitude],name:"location_id")
  user User @relation(fields: [userId], references: [id])
  userId String @unique
}



model Message{
  id Int @id
  chatId Int
  senderId String
  recieverId String
  message String
  date DateTime @default(now())
  read Boolean @default(false)
//  sender User @relation(fields: [senderId], references: [id])
//  reciever User @relation(fields: [recieverId], references: [id])
}

model Notification{
  id Int @id
  userId Int
  message String
  date DateTime @default(now())
  read Boolean @default(false)
}

model Batch {
  id        Int     @id @default(autoincrement())
  //teacher   User    @relation(fields: [teacherId], references: [id])
  teacherId Int
  //students  User[]  //@relation(fields: []),
}

model Appointment {
  id    Int @id @default(autoincrement())
  teacherId Int
  studentId Int
  date DateTime
}

